# NFC Contact Logger 🏷️

이 프로젝트는 별도의 네이티브 앱 설치 없이, 웹 기술만으로 현실의 사물(NFC 태그)과 사용자의 상호작용을 기록하는 시스템을 구축하는 것을 목표로 합니다.

사용자가 특정 사물에 부착된 NFC 태그에 스마트폰을 접촉하면, 해당 사물의 고유 ID와 사용자의 기기 ID가 서버에 기록됩니다. 이를 통해 사용자의 물리적 동선을 디지털 데이터로 변환하고, 향후 개인화된 추천이나 결제 서비스로 확장할 수 있는 기반을 마련하고자 합니다.

---

## ✨ 주요 기능

- **NFC-to-Web 연동:** NFC 태그 접촉 시 지정된 프론트엔드 웹페이지(`www.almang.shop`)를 자동으로 실행합니다.
- **로그인 없는 기기 식별:** 백엔드 서버에서 발급하는 퍼스트 파티 쿠키(First-party Cookie)를 이용하여, 사용자 로그인 없이도 브라우저를 고유하게 식별합니다.
- **풀스택 아키텍처:**
  - **Frontend:** Vercel에 배포된 정적 웹페이지 (HTML, CSS, Vanilla JS).
  - **Backend:** Railway에 배포된 Python/FastAPI 서버.
- **'같은 도메인' 전략:** `www.almang.shop`(프론트엔드)과 `api.almang.shop`(백엔드)을 같은 최상위 도메인 아래에 두어, 브라우저의 사이트 간 보안 정책(CORS, ITP) 문제를 해결합니다.

---

## ⚙️ 현재 아키텍처 (Frontend-First)

1.  **NFC 태그:** `https://www.almang.shop/?item=[아이템_ID]` 형식의 **프론트엔드 주소**를 저장하고 있습니다.
2.  **사용자 접촉:** 사용자가 태그에 스마트폰을 접촉하면, 브라우저가 프론트엔드 페이지를 엽니다.
3.  **프론트엔드 (`script.js`):**
    - 페이지가 로드되면, 백엔드(`https://api.almang.shop/api/generate-id`)로 `fetch` 요청을 보내 기기 ID 쿠키를 발급받거나 확인합니다.
    - URL에서 아이템 ID를 읽어온 뒤, 발급받은 기기 ID와 함께 백엔드(`https://api.almang.shop/api/log-tap`)로 `fetch` 요청을 보내 접촉 사실을 최종 기록합니다.
4.  **백엔드 (`main.py`):**
    - 프론트엔드로부터 들어온 요청을 받아, 쿠키를 발급하거나 접촉 로그를 터미널에 출력합니다.

---

## ⚠️ 현재 상태 및 알려진 한계점

이 프로젝트는 기나긴 디버깅 과정을 통해 현대 웹 브라우저의 복잡한 보안 정책에 대응하는 아키텍처로 발전했습니다......하지만.

**현재 상태:**

- **크롬(Chrome)을 사용하는 대부분의 안드로이드 및 데스크톱 환경에서는 완벽하게 작동합니다.** 퍼스트 파티 쿠키를 통해 사용자를 안정적으로 식별하고, 접촉 기록을 서버에 성공적으로 전송합니다.

**알려진 한계점:**

- **아이폰의 사파리(Safari) 브라우저에서는 지능형 추적 방지(ITP) 정책으로 인해 쿠키가 안정적으로 저장되지 않는 문제가 계속 발생합니다.**
- 이는 코드의 버그가 아닌, 웹 기술만으로 외부 앱(NFC 시스템)에서 시작된 사용자 세션을 완벽하게 추적하려는 시도와, 이를 막으려는 브라우저의 강력한 개인정보 보호 정책 사이의 근본적인 충돌입니다.
- 결과적으로 현재 아키텍처에서는, **사파리 사용자들은 NFC 태그를 접촉할 때마다 새로운 기기 ID를 발급받게 되어, 연속적인 사용자 행동 추적이 불가능합니다.**

이 한계점을 극복하고 모든 사용자에게 일관된 경험을 제공하기 위한 다음 단계는 **'소셜 로그인'**과 같은 명시적인 사용자 인증 시스템을 도입하는 것입니다. -> 소셜 로그인 도입하러 갑니다
